<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Soal8</title>
    </head>
    <body>
        <h1>Soal 9</h1>

        <script>
            const dataPenjualanNovel = [
                {
                    idProduct: "BOOK002421",
                    namaProduk: "Pulang - Pergi",
                    penulis: "Tere Liye",
                    hargaBeli: 60000,
                    hargaJual: 86000,
                    totalTerjual: 150,
                    sisaStok: 17,
                },
                {
                    idProduct: "BOOK002351",
                    namaProduk: "Selamat Tinggal",
                    penulis: "Tere Liye",
                    hargaBeli: 75000,
                    hargaJual: 103000,
                    totalTerjual: 171,
                    sisaStok: 20,
                },
                {
                    idProduct: "BOOK002941",
                    namaProduk: "Garis Waktu",
                    penulis: "Fiersa Besari",
                    hargaBeli: 67000,
                    hargaJual: 99000,
                    totalTerjual: 213,
                    sisaStok: 5,
                },
                {
                    idProduct: "BOOK002941",
                    namaProduk: "Laskar Pelangi",
                    penulis: "Andrea Hirata",
                    hargaBeli: 55000,
                    hargaJual: 68000,
                    totalTerjual: 20,
                    sisaStok: 56,
                },
            ];

            function getInfoPenjualan(dataPenjualan) {
                // cek parameter
                if (dataPenjualan == null) {
                    throw "Parameter tidak boleh kosong";
                } else if (typeof dataPenjualan != "object") {
                    throw "Data Tidak valid, harus berupa array";
                }

                var repo = 0;
                var repo2 = {};
                const hitung = dataPenjualan.reduce(
                    (res, key) => {
                        res.totalKeuntungan += key.hargaJual * key.totalTerjual;

                        res.totalModal += key.hargaBeli * (key.totalTerjual + key.sisaStok);

                        key.persentaseKeuntungan++;

                        if (key.totalTerjual > repo) {
                            repo = key.totalTerjual;
                            res.produkBukuTerlaris = key.namaProduk;
                        }

                        /*
                            1. ambil semua namaPenulis (key) : totalTerjual(value) v
                                if nama sama {totalTerjaul++} v
                            2. cek value terbesar
                            3. get nama penulis = res
                        */

                        // if (key.penulis in repo2) {
                        //     aa = key.totalTerjual;
                        //     bb = key.penulis;
                        //     repo2.bb += aa;
                        // } else {
                        //     repo2[key.penulis] = key.totalTerjual;
                        // }

                        // cc = Math.max(...repo2);

                        // res.penulisTerlaris = cc;

                        return res;
                    },
                    {
                        totalKeuntungan: 0,
                        totalModal: 0,
                        persentaseKeuntungan: 0,
                        produkBukuTerlaris: "",
                        penulisTerlaris: "",
                    }
                );

                return hitung;
            }

            // try {
            console.log(getInfoPenjualan(dataPenjualanNovel));
            // } catch (error) {
            //     console.log("Error : " + error);
            // }
        </script>
    </body>
</html>
